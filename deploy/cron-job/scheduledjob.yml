apiVersion: batch/v2alpha1
kind: ScheduledJob
metadata:
  name: "go-xample-cron-job-{{.CurrentEnvironment}}"
  labels:
    project: go-xample
    service: cron-job
    env: {{.CurrentEnvironment}}
spec:
  schedule: '0 0 * * *'
  jobTemplate:
    spec:
      selector:
        matchLabels:
          project: go-xample
          service: cron-job
          env: {{.CurrentEnvironment}}
      template:
        metadata:
          labels:
            project: go-xample
            service: cron-job
            release: '{{.Version}}'
            env: {{.CurrentEnvironment}}
        spec:
          nodeSelector:
            env: production
          imagePullSecrets:
          - name: blregistry
          containers:
          - name: go-xample-cron-job
            image: registry.bukalapak.io/bukalapak/go-xample/cron-job:{{.Version}}
            command:
              - envconsul
              - -once
              - -consul=$(CONSUL1)
              - -sanitize
              - -upcase
              - -prefix=go-xample
              - cron-job
            env:
          	- name: CONSUL
              valueFrom:
                configMapKeyRef:
                  name: consul-config
                  key: node1
          restartPolicy: never
